---
import { getCollection, getEntry } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import AnimatedTitle from '../components/AnimatedTitle.astro';
import CanvasBackground from '../components/CanvasBackground.astro';
import ArrowScrollDown from '../../public/arrow-scroll-down.svg?raw';
import DisplayCard from '../components/DisplayCard.astro';

const about = await getEntry('cards', 'about');
const work = await getCollection(
  'cards',
  ({ data }) => data.type === 'work'
).then((response) =>
  response.sort((a: any, b) => (a.data.sortOrder < b.data.sortOrder ? -1 : 1))
);

const play = await getCollection(
  'cards',
  ({ data }) => data.type === 'play'
).then((response) =>
  response.sort((a: any, b) => (a.data.sortOrder < b.data.sortOrder ? -1 : 1))
);
---

<Layout title="Alexander Mold's Portfolio">
  <header
    class="w-full relative flex items-center justify-center text-center h-dvh"
  >
    <CanvasBackground />
    <span
      class="click-me absolute top-10 left-10 -rotate-12 text-sm font-handwriting pointer-events-none"
    >
      (click me)
    </span>
    <div class="relative pointer-events-none">
      <AnimatedTitle text="Alexander Mold" />
      <p class="text-xl">Software Engineer</p>
    </div>
    <div class="scroll-down-container absolute bottom-6">
      <button class="scroll-down w-12" id="scroll-down">
        <Fragment set:html={ArrowScrollDown} />
      </button>
    </div>
  </header>
  <main class="w-full max-w-xl p-5 mx-auto" id="main">
    <div>
      <DisplayCard
        title={about.data.title}
        text={about.data.text}
        theme="yellow"
      />
    </div>
    <div class="mb-20">
      <h3 class="text-5xl font-bold">Work</h3>
      {
        work.map((card: any, index) => {
          const theme = index % 2 === 0 ? 'red' : '';
          const direction = index % 2 === 0 ? 'left' : 'right';

          return (
            <DisplayCard
              title={card.data.title}
              text={card.data.text}
              theme={theme}
              direction={direction}
            />
          );
        })
      }
    </div>
    <div class="mb-20">
      <h3 class="text-5xl font-bold">Play</h3>
      {
        play.map((card: any, index) => {
          const theme = index % 2 === 0 ? 'red' : '';
          const direction = index % 2 === 0 ? 'left' : 'right';

          return (
            <DisplayCard
              title={card.data.title}
              text={card.data.text}
              theme={theme}
              direction={direction}
            />
          );
        })
      }
    </div>
  </main>
</Layout>

<script>
  // Scroll down to main content on button click
  const handleScrollToMain = () => {
    const mainElement = document.getElementById('main');
    if (!mainElement) {
      return;
    }
    mainElement.scrollIntoView({
      behavior: 'smooth',
    });
  };

  const scrollDownButton = document.getElementById(
    'scroll-down'
  ) as HTMLElement;
  scrollDownButton.addEventListener('click', handleScrollToMain);

  // Add animation class when each display card is visible
  const cardElements = document.querySelectorAll('.display-card');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('active');
      }
    });
  });

  cardElements.forEach((element) => observer.observe(element));
</script>

<style lang="scss">
  header {
    max-height: 600px;

    p {
      opacity: 0;
      margin-top: 1em;
      animation: RiseUp 450ms cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
      animation-delay: 1000ms;
    }

    .click-me {
      opacity: 0;
      display: inline-block;
      animation: OpacityIn 200ms cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
      animation-delay: 1500ms;
    }
  }

  .scroll-down-container {
    opacity: 0;
    animation: OpacityIn 2500ms cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
    animation-delay: 2500ms;
  }

  .scroll-down {
    animation: ScrollDown 2500ms cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
  }

  @keyframes RiseUp {
    from {
      opacity: 0;
      transform: translateY(50px) skew(20deg);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes OpacityIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes ScrollDown {
    0% {
      opacity: 0;
      transform: translateY(-10px);
    }
    10% {
      opacity: 0;
      transform: translateY(-20px);
    }
    30% {
      opacity: 1;
      transform: translateY(0);
    }
    70% {
      opacity: 1;
      transform: translateY(0);
    }
    90% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 0;
      transform: translateY(20px);
    }
  }
</style>
